srcIPchange = "false"
dstIPchange = "false"

with open("nfdumpTestFile", 'r') as captureFile:
    for captureLine in captureFile:
        if "Date" not in captureLine:
            extractedLine = captureLine.split()
            try:
                srcIP = extractedLine[5]
                dstIP = extractedLine[7]
                srcIP = str(srcIP.split(":",1)[0])
                dstIP = str(dstIP.split(":",1)[0])
            except:
                continue
            with open("nslookupUniqPy.txt", 'r') as file:
                for line in file:
                    if "Authoritative" not in line:
                        if "** server " not in line:
                            ipAddressReverse = str(line.split(".in-addr",1)[0])
                            name = str(line.split("name = ", 1)[-1])
                            try:
                                ipAddressSplit = ipAddressReverse.split(".",4)[3] + "." + ipAddressReverse.split(".",4)[2] + "." + ipAddressReverse.split(".",4)[1] + "." + ipAddressReverse.split(".",4)[0]
                                if srcIP == ipAddressSplit:
                                    extractedLine[5] = name
                                    srcIPchange = "true"
                                elif dstIP == ipAddressSplit:
                                    extractedLine[7] = name
                                    dstIPchange = "true"

                                if srcIPchange == "true" and dstIPchange == "true":
                                    print(extractedLine)
                                    fileOut = open("MergedFiles.txt", "a")
                                    fileOut.write(str(extractedLine))
                                    fileOut.write('\n')
                                    fileOut.close()
                                    #added to prevent constant printing
                                    srcIPchange = "false"
                                    dstIPchange = "false"
                                
                            except:
                                continue
                        else:
                            ipAddressUnknownRev = str(line.split(".in-addr",1)[0])
                            ipAddressUnknownRev = str(ipAddressUnknownRev.split("** server can't find ",1)[-1])
                            try:
                                ipAddressSplitUnk = ipAddressUnknownRev.split(".",4)[3] + "." + ipAddressUnknownRev.split(".",4)[2] + "." + ipAddressUnknownRev.split(".",4)[1] + "." + ipAddressUnknownRev.split(".",4)[0]
                                if srcIP == ipAddressSplitUnk:
                                    extractedLine[5] = "Unknown"
                                    srcIPchange = "true"
                                elif dstIP == ipAddressSplitUnk:
                                    extractedLine[7] = "Unknown"
                                    dstIPchange = "true"

                                if srcIPchange == "true" and dstIPchange == "true":
                                    print(extractedLine)
                                    fileOut = open("MergedFiles.txt", "a")
                                    fileOut.write(str(extractedLine))
                                    fileOut.write('\n')
                                    fileOut.close()
                                    #added to prevent constant printing
                                    srcIPchange = "false"
                                    dstIPchange = "false"
                                
                            except:
                                continue
